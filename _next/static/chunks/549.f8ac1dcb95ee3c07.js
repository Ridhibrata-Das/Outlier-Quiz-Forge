"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[549],{90549:function(e,r,s){s.r(r);var i=s(85893),l=s(67294),a=s(45697),n=s.n(a),t=s(91768),o=s(82453),d=s(9661),u=s(86501),c=s(46458),v=s(77874),h=s(9473),m=s(9559),w=s(31417),p=s(52984),f=s(23115),g=s(86455),y=s.n(g),x=s(77630),j=s.n(x),_=s(39332),b=s(27262),A=s(72089),U=s(39828),B=s(52732),E=s(96766),N=s(18593),S=s(25675),C=s.n(S);let k=j()(y()),q=e=>{var r,s;let{t:a,questions:n,timerSeconds:t,onOptionClick:g,onQuestionEnd:y,showBookmark:x}=e,[j,S]=(0,l.useState)(n),[q,Q]=(0,l.useState)(0),R=(0,h.I0)(),T=(0,U.ad)(),[Z,D]=(0,l.useState)(!1),[I,J]=(0,l.useState)([]),F=(0,l.useRef)(null),P=(0,l.useRef)(null),W=(0,l.useRef)(0),z=(0,_.useRouter)(),O=(0,h.v9)(e=>e.User),Y=(0,h.v9)(e=>e.message),G=(0,h.v9)(p.fg),X=(0,h.v9)(f.Vb),H=null==X?void 0:null===(r=X.data)||void 0===r?void 0:r.find(e=>(null==e?void 0:e.type)==="clash_winner"),L=H&&(null==H?void 0:H.status),M=H&&(null==H?void 0:H.badge_reward),V=(0,l.useRef)(!1),[K,$]=(0,l.useState)({}),[ee,er]=(0,l.useState)(),[es,ei]=(0,l.useState)(!1),el=e=>{$({...K,[e]:!0})};setTimeout(()=>{S(n)},500);let ea=G.roomID,en=async e=>{try{await (0,U.oe)((0,U.JU)(T,"multiUserBattleRoom",e))}catch(e){u.ZP.error(e)}},et=[{uid:G.user1uid,point:G.user1point},{uid:G.user2uid,point:G.user2point},{uid:G.user3uid,point:G.user3point},{uid:G.user4uid,point:G.user4point}],eo=()=>{if("0"===L)for(let r=0;r<(null==et?void 0:et.length);r++){var e;let s=et[r];if((null==O?void 0:null===(e=O.data)||void 0===e?void 0:e.id)===s.uid){let e=!0;for(let i=0;i<(null==et?void 0:et.length);i++)if(r!==i&&s.point<=et[i].point){e=!1;break}e&&(0,m.gs)("clash_winner",e=>{var r;(0,f.sQ)("clash_winner","1"),u.ZP.success(a(null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.notification_body)),(0,m.zw)({coins:M,title:a("clash_badge_reward"),status:0,onSuccess:e=>{(0,m.Gq)({onSuccess:e=>{(0,w.X5)(e.data)},onError:e=>{console.log(e)}})},onError:e=>{console.log(e)}})},e=>{console.log(e)});break}}},ed=()=>{let e=q+1;if(e<(null==j?void 0:j.length))Q(e),F.current.resetTimer();else{let e=W.current,r=100*e/(null==j?void 0:j.length);(0,m.Q1)({questions_answered:null==j?void 0:j.length,correct_answers:e,category_id:j[q].category,percentage:r,onSuccess:e=>{},onError:e=>{console.log(e)}})}},eu=async e=>{if(!K.hasOwnProperty(q)){var r;el(q);let{id:s,answer:i}=j[q],l=(0,d.QY)(i,null==O?void 0:null===(r=O.data)||void 0===r?void 0:r.firebase_id),a=W.current;l===e&&(a++,W.current=a);let n=j[q];(0,d.ED)(e,n.answer);let t=j.map(r=>r.id===s?{...r,selected_answer:e,isAnswered:!0}:r);S(t),ev(e),R((0,b.Rp)(a)),g(t,a),R((0,b.gk)(t))}},ec=(e,r,s,i,l,a,n,t,o,d,u,c)=>{(0,p.yB)("user1name",e),(0,p.yB)("user2name",r),(0,p.yB)("user3name",s),(0,p.yB)("user4name",i),(0,p.yB)("user1image",l),(0,p.yB)("user2image",a),(0,p.yB)("user3image",n),(0,p.yB)("user4image",t),(0,p.yB)("user1uid",o),(0,p.yB)("user2uid",d),(0,p.yB)("user3uid",u),(0,p.yB)("user4uid",c)},ev=async e=>{try{let a=(0,U.JU)(T,"multiUserBattleRoom",ea),n=await (0,U.QT)(a);if(n.exists()){var r,s,i,l;let t=n.data(),o=t.user1.answers,d=t.user2.answers,u=t.user3.answers,c=t.user4.answers;(null==O?void 0:null===(r=O.data)||void 0===r?void 0:r.id)===t.user1.uid?(o.push(e),await (0,U.r7)(a,{"user1.answers":o})):(null==O?void 0:null===(s=O.data)||void 0===s?void 0:s.id)===t.user2.uid?(d.push(e),await (0,U.r7)(a,{"user2.answers":d})):(null==O?void 0:null===(i=O.data)||void 0===i?void 0:i.id)===t.user3.uid?(u.push(e),await (0,U.r7)(a,{"user3.answers":u})):(null==O?void 0:null===(l=O.data)||void 0===l?void 0:l.id)===t.user4.uid&&(c.push(e),await (0,U.r7)(a,{"user4.answers":c})),setTimeout(()=>{ed()},1e3),eh(e)}}catch(e){console.error("Error submitting answer:",e)}},eh=async e=>{try{let u=(0,U.JU)(T,"multiUserBattleRoom",ea),c=await (0,U.QT)(u);if(c.exists()){var r,s,i,l,a,n,t,o;let v=c.data(),h=v.user1.name,m=v.user2.name,w=v.user3.name,p=v.user4.name,f=v.user1.profileUrl,g=v.user2.profileUrl,y=v.user3.profileUrl,x=v.user4.profileUrl,_=v.user1.correctAnswers,b=v.user2.correctAnswers,A=v.user3.correctAnswers,B=v.user4.correctAnswers,E=v.user1.uid,N=v.user2.uid,S=v.user3.uid,C=v.user4.uid;ec(h,m,w,p,f,g,y,x,E,N,S,C),(null==O?void 0:null===(r=O.data)||void 0===r?void 0:r.id)===v.user1.uid?(0,d.QY)(j[q].answer,null==O?void 0:null===(a=O.data)||void 0===a?void 0:a.firebase_id)===e&&await (0,U.r7)(u,{"user1.correctAnswers":_+1}):(null==O?void 0:null===(s=O.data)||void 0===s?void 0:s.id)===v.user2.uid?(0,d.QY)(j[q].answer,null==O?void 0:null===(n=O.data)||void 0===n?void 0:n.firebase_id)===e&&await (0,U.r7)(u,{"user2.correctAnswers":b+1}):(null==O?void 0:null===(i=O.data)||void 0===i?void 0:i.id)===v.user3.uid?(0,d.QY)(j[q].answer,null==O?void 0:null===(t=O.data)||void 0===t?void 0:t.firebase_id)===e&&await (0,U.r7)(u,{"user3.correctAnswers":A+1}):(null==O?void 0:null===(l=O.data)||void 0===l?void 0:l.id)===v.user4.uid&&(0,d.QY)(j[q].answer,null==O?void 0:null===(o=O.data)||void 0===o?void 0:o.firebase_id)===e&&await (0,U.r7)(u,{"user4.correctAnswers":B+1})}}catch(e){console.error("Error checking correct answers:",e)}},em=async()=>{try{let l=(0,U.JU)(T,"multiUserBattleRoom",ea),a=await (0,U.QT)(l);if(a.exists()){var e,r,s,i;let n=a.data(),t=n.user1.answers,o=n.user2.answers,d=n.user3.answers,u=n.user4.answers;(null==O?void 0:null===(e=O.data)||void 0===e?void 0:e.id)===n.user1.uid?(t.push(-1),await (0,U.r7)(l,{"user1.answers":t})):(null==O?void 0:null===(r=O.data)||void 0===r?void 0:r.id)===n.user2.uid?(o.push(-1),await (0,U.r7)(l,{"user2.answers":o})):(null==O?void 0:null===(s=O.data)||void 0===s?void 0:s.id)===n.user3.uid?(d.push(-1),await (0,U.r7)(l,{"user3.answers":d})):(null==O?void 0:null===(i=O.data)||void 0===i?void 0:i.id)===n.user4.uid&&(u.push(-1),await (0,U.r7)(l,{"user4.answers":u}))}}catch(e){console.error("Error on timer expire:",e)}finally{ed()}};(0,l.useEffect)(()=>{let e=(0,U.JU)(T,"multiUserBattleRoom",ea),r=!1,s=!1,i=(0,U.cf)(e,e=>{let i=!0,l=!1;if(e.exists&&e.data()){let n=e.data(),t=n.user1,o=n.user2,d=n.user3,u=n.user4,c=n.entryFee;(0,p.yB)("entryFee",c);let v=t.correctAnswers;(0,p.yB)("user1CorrectAnswer",v);let h=o.correctAnswers;(0,p.yB)("user2CorrectAnswer",h);let f=d.correctAnswers;(0,p.yB)("user3CorrectAnswer",f);let g=u.correctAnswers;(0,p.yB)("user4CorrectAnswer",g);let x=[];x=[t,o,d,u],J([t,o,d,u]);let _=[t,o,d,u],b=_.filter(e=>""!==e.uid);s||(s=!0,(0,p.yB)("totalusers",null==b?void 0:b.length)),r||(r=!0,_.forEach(e=>{var r;(null==O?void 0:null===(r=O.data)||void 0===r?void 0:r.id)===e.uid&&""!==e.uid&&c>0&&(0,m.zw)({coins:"-"+n.entryFee,title:a("played_battle"),status:1,onSuccess:e=>{(0,m.Gq)({onSuccess:e=>{(0,w.X5)(e.data)},onError:e=>{console.log(e)}})},onError:e=>{console.log(e)}})}));let A=_.filter(e=>{var r;return(null===(r=Object.keys(e.uid))||void 0===r?void 0:r.length)>0});_.forEach(e=>{""===e.obj&&(V.current=!0)}),(null==A?void 0:A.length)<2&&(en(ea),k.fire({title:a("Everyone has left the game"),icon:"warning",showCancelButton:!1,customClass:{confirmButton:"Swal-confirm-buttons",cancelButton:"Swal-cancel-buttons"},confirmButtonText:a("ok")}).then(e=>{if(e.isConfirmed){let e=c*G.totalusers;A.forEach(r=>{var s;(null==O?void 0:null===(s=O.data)||void 0===s?void 0:s.id)==r.uid&&c>0&&(0,m.zw)({coins:e,title:a("won_battle"),status:0,onSuccess:e=>{(0,m.Gq)({onSuccess:e=>{(0,w.X5)(e.data)},onError:e=>{console.log(e)}})},onError:e=>{console.log(e)}})}),z.push("/quiz-play")}})),x.forEach(e=>{if(""!=e.uid){var r,s,a;(null===(r=e.answers)||void 0===r?void 0:r.length)<(null==j?void 0:j.length)?i=!1:e.uid==(null==O?void 0:null===(s=O.data)||void 0===s?void 0:s.id)&&(null===(a=e.answers)||void 0===a?void 0:a.length)>=(null==j?void 0:j.length)&&(F.current.pauseTimer(),l=!0)}}),l&&D(!0),i&&(y(),eo(),en(ea))}},e=>{console.log("err",e)}),l=[G.user1uid,G.user2uid,G.user3uid,G.user4uid];for(let e=0;e<(null==l?void 0:l.length);e++){var n;let r=l[e];if((null==O?void 0:null===(n=O.data)||void 0===n?void 0:n.id)==r&&V){z.push("/quiz-play"),i();break}}return()=>{i()}},[null==O?void 0:null===(s=O.data)||void 0===s?void 0:s.id,V]),(0,l.useEffect)(()=>{eh()},[]),(0,l.useEffect)(()=>()=>{let e=(0,U.JU)(T,"multiUserBattleRoom",ea);try{(0,U.i3)(T,async r=>{var s,i,l,a;let n=(await r.get(e)).data(),t=n&&n.user1.uid,o=n&&n.user2.uid,d=n&&n.user3.uid,u=n&&n.user4.uid;t==(null==O?void 0:null===(s=O.data)||void 0===s?void 0:s.id)?r.update(e,{"user1.name":"","user1.uid":"","user1.profileUrl":""}):o==(null==O?void 0:null===(i=O.data)||void 0===i?void 0:i.id)?r.update(e,{"user2.name":"","user2.uid":"","user2.profileUrl":""}):d==(null==O?void 0:null===(l=O.data)||void 0===l?void 0:l.id)?r.update(e,{"user3.name":"","user3.uid":"","user3.profileUrl":""}):u==(null==O?void 0:null===(a=O.data)||void 0===a?void 0:a.id)&&r.update(e,{"user4.name":"","user4.uid":"","user4.profileUrl":""})})}catch(e){console.error("Transaction failed:",e)}},[]);let ew=I.find(e=>{var r;return e.uid===(null==O?void 0:null===(r=O.data)||void 0===r?void 0:r.id)}),ep=async()=>{if(null!==Y.firestoreId)try{await (0,U.oe)((0,U.JU)(T,"messages",Y.firestoreId))}catch(e){u.ZP.error(e.message||"An error occurred")}};(0,l.useEffect)(()=>{if(G.roomID){let e=(0,U.IO)((0,U.hJ)(T,"messages"),(0,U.ar)("roomId","==",G.roomID)),r=(0,U.cf)(e,e=>{e.docChanges().forEach(e=>{let r=e.doc.data();"added"===e.type&&(er(r),ei(!0),setTimeout(()=>{ei(!1),ep()},"4000"))})});return()=>r()}},[]);let ef=(0,i.jsx)("div",{children:ee?ee.isTextMessage?(0,i.jsx)("div",{children:ee.message}):ee.message&&(0,i.jsx)("div",{children:(0,i.jsx)(C(),{src:ee.message,height:50,width:50,alt:"Message Image"})}):(0,i.jsx)("div",{children:"No message data available"})}),eg=()=>{if(void 0!==ee)return(0,i.jsx)(c.Z,{wrap:!0,className:"msgPopUpWrapper",children:(0,i.jsx)(v.Z,{content:ef,overlayStyle:{backgroundColor:"#f0f0f0"},open:es})})};return(0,i.jsxs)(l.Fragment,{children:[(0,i.jsx)("div",{className:"dashboardPlayUppDiv funLearnQuestionsUpperDiv selfLearnQuestionsUpperDiv text-end p-2 pb-0 ",children:(0,i.jsx)(B.Z,{corrAns:"",inCorrAns:"",currentQuestion:q,questions:j,showAnswers:!1})}),(0,i.jsxs)("div",{className:"questions battlequestion groupbattle",ref:P,children:[(0,i.jsx)("div",{className:"inner__headerdash groupPlay_header",children:(0,i.jsx)("div",{className:"inner__headerdash_data",children:j&&""!==j[0].id?(0,i.jsx)(o.Z,{ref:F,timerSeconds:t,onTimerExpire:em}):""})}),(0,i.jsx)(A.default,{questions:j,currentQuestion:q,setAnswerStatusClass:e=>{let r=j[q];return(0,d.Z1)(e,r.isAnswered,r.answer,r.selected_answer)},handleAnswerOptionClick:eu,probability:!1,latex:!0}),(0,i.jsx)("div",{className:"divider",children:(0,i.jsx)("hr",{style:{width:"112%",backgroundColor:"gray",height:"2px"}})}),(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,i.jsx)(E.Z,{})}),(0,i.jsxs)("div",{className:"user_data",children:[ew&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"user_profile",children:[void 0!==ee&&(null==ew?void 0:ew.uid)==ee.by&&eg(),(0,i.jsx)("img",{src:ew.profileUrl,alt:"wrteam",onError:d.HS}),(0,i.jsxs)("div",{className:"userDataWrapper",children:[(0,i.jsx)("p",{className:"mt-3",children:ew.name?ew.name:"Waiting..."}),(0,i.jsx)("div",{className:"userpoints",children:(0,i.jsx)("div",{className:"rightWrongAnsDiv",children:(0,i.jsxs)("span",{className:"rightAns",children:[ew.correctAnswers?ew.correctAnswers:0," /"," ",(0,i.jsx)("span",{children:null==j?void 0:j.length})]})})})]})]})}),null==I?void 0:I.map(e=>{var r;return e.uid!==(null==O?void 0:null===(r=O.data)||void 0===r?void 0:r.id)&&""!==e.uid?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"opponent_image",children:[void 0!==ee&&(null==ew?void 0:ew.uid)!==e.uid&&e.uid==ee.by&&eg(),(0,i.jsx)("img",{src:e.profileUrl,alt:"wrteam",onError:d.HS}),(0,i.jsxs)("div",{className:"opponentUserdataWrapper",children:[(0,i.jsx)("p",{className:"mt-3",children:e.name?e.name:"Waiting..."}),(0,i.jsx)("div",{className:"rightWrongAnsDiv",children:(0,i.jsxs)("span",{className:"rightAns",children:[e.correctAnswers?e.correctAnswers:0," / ",(0,i.jsx)("span",{children:null==j?void 0:j.length})]})})]})]})}):null})]}),(0,i.jsx)(N.Z,{closable:!1,keyboard:!1,centered:!0,open:Z,footer:null,className:"custom_modal_notify retry-modal playwithfriend",children:Z?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("p",{children:a("wait_for_other_complete")})}):""})]})]})};q.propTypes={questions:n().array.isRequired,onOptionClick:n().func.isRequired},r.default=(0,t.Z)()(q)}}]);